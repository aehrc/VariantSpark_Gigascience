LogURI=s3n://variant-spark/GigaScience/EMR-LOG/

# only works with aws2 (not aws)
aws2 emr create-cluster --applications Name=Hadoop Name=Spark Name=Ganglia Name=Hive Name=Hue Name=Pig --ec2-attributes '{"InstanceProfile":"EMR_EC2_DefaultRole"}' --release-label emr-4.5.0 --log-uri "$LogURI" --steps '[{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v100.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"100"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v200.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"200"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v400.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"400"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v800.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"800"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v1600.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"1600"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v3200.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"3200"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v6400.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"6400"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v12800.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"12800"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v25600.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"25600"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v51200.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"51200"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v102400.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"102400"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v204800.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"204800"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v409600.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"409600"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v819200.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"819200"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v1638400.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"1638400"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v3276800.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"3276800"},{"Args":["spark-submit","--deploy-mode","client","--class","app.TestApp","/home/hadoop/test-yggdrasil/target/test-yggdrasil-0.1.0-SNAPSHOT-all.jar","s3://variant-spark/GigaScience/Data/Yggdrasil2/dataset.s10000.v6553600.csv.bz2","s3://variant-spark/GigaScience/Data/Yggdrasil2/pheno.csv","10","512"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"command-runner.jar","Properties":"","Name":"6553600"}]' --instance-groups '[{"InstanceCount":16,"BidPrice":"OnDemandPrice","EbsConfiguration":{"EbsBlockDeviceConfigs":[{"VolumeSpecification":{"SizeInGB":256,"VolumeType":"gp2"},"VolumesPerInstance":1}],"EbsOptimized":true},"InstanceGroupType":"CORE","InstanceType":"r4.4xlarge","Name":"Core"},{"InstanceCount":1,"BidPrice":"OnDemandPrice","EbsConfiguration":{"EbsBlockDeviceConfigs":[{"VolumeSpecification":{"SizeInGB":128,"VolumeType":"gp2"},"VolumesPerInstance":1}],"EbsOptimized":true},"InstanceGroupType":"MASTER","InstanceType":"r4.2xlarge","Name":"Master"}]' --configurations '[{"Classification":"core-site","Properties":{"hadoop.proxyuser.livy.groups":"*","hadoop.proxyuser.livy.hosts":"*"}},{"Classification":"spark-defaults","Properties":{"spark.sql.files.openCostInBytes":"1099511627776","spark.hadoop.io.compression.codecs":"org.apache.hadoop.io.compress.DefaultCodec,org.apache.hadoop.io.compress.GzipCodec","spark.hadoop.parquet.block.size":"1099511627776","spark.executor.extraClassPath":"/usr/lib/hadoop-lzo/lib/*:/usr/lib/hadoop/hadoop-aws.jar:/usr/share/aws/aws-java-sdk/*:/usr/share/aws/emr/emrfs/conf:/usr/share/aws/emr/emrfs/lib/*:/usr/share/aws/emr/emrfs/auxlib/*:/usr/share/aws/emr/security/conf:/usr/share/aws/emr/security/lib/*:/home/hadoop/hail-all-spark.jar:/home/hadoop/Yggdrasil/yggdrasil/target/scala-2.10/yggdrasil_2.10-1.0.jar","spark.driver.extraClassPath":"/usr/lib/hadoop-lzo/lib/*:/usr/lib/hadoop/hadoop-aws.jar:/usr/share/aws/aws-java-sdk/*:/usr/share/aws/emr/emrfs/conf:/usr/share/aws/emr/emrfs/lib/*:/usr/share/aws/emr/emrfs/auxlib/*:/usr/share/aws/emr/security/conf:/usr/share/aws/emr/security/lib/*:/home/hadoop/hail-all-spark.jar:/home/hadoop/Yggdrasil/yggdrasil/target/scala-2.10/yggdrasil_2.10-1.0.jar","spark.serializer":"org.apache.spark.serializer.KryoSerializer","spark.sql.files.maxPartitionBytes":"1099511627776"}}]' --auto-terminate --auto-scaling-role EMR_AutoScaling_DefaultRole --bootstrap-actions '[{"Path":"s3://variant-spark/GigaScience/Yggdrasil/install-test-yggdrasil.sh","Name":"Instal-test-Yggdrasil"}]' --ebs-root-volume-size 32 --service-role EMR_DefaultRole --enable-debugging --name 'C256 Yggdrasil2 Final' --scale-down-behavior TERMINATE_AT_TASK_COMPLETION